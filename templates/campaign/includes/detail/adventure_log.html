{% load markdown_extras %}

<div class="d-flex align-items-center justify-content-between mb-3 px-1">
    <h3 class="h5 fw-bold mb-0 text-dark">Adventure Log</h3>
</div>
{% if request.user == campaign.dungeon_master and announcement_form %}
    <div class="mb-4">
        <form method="post"
              action="{% url 'campaign_announcement_create' pk=campaign.pk %}">
            {% csrf_token %}
            <div class="mb-2">{{ announcement_form.message }}</div>
            <div class="d-flex justify-content-end">
                <button type="submit" class="btn btn-primary btn-sm">
                    <i class="bi bi-send-fill"></i> Post Announcement
                </button>
            </div>
        </form>
    </div>
{% endif %}
<div class="feed-container">
    {% for item in campaign.feed_items.all %}
        <div class="card border-0 shadow-sm mb-3 rounded-3 feed-card">
            <div class="card-body p-3">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="badge bg-light text-secondary border fw-normal">{{ item.created_at|date:"M d" }}</span>
                    <small class="text-muted">{{ item.created_at|date:"H:i" }}</small>
                </div>
                {# Apply markdown filter and then mark as safe #}
                <div class="mb-0 text-dark">{{ item.message|markdown|safe }}</div>
            </div>
        </div>
    {% empty %}
        <div class="text-center py-5 rounded-4 bg-light-subtle border border-dashed">
            <div class="text-muted mb-2 feed-empty-icon">ðŸ“­</div>
            <p class="mb-0 text-muted fw-semibold">No recent activity recorded.</p>
            <p class="small text-muted">Game updates and events will appear here.</p>
        </div>
    {% endfor %}
</div>
